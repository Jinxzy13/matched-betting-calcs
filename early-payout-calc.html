<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Early Payout Calculator — DipsyDiver style</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    body {
      font-family: 'Ubuntu', sans-serif;
      background: radial-gradient(circle at 50% 30%, #04394a, #021e28 80%);
      color: #e6faff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    #mb-calc {
      background: rgba(0, 45, 60, 0.85);
      border: 1px solid #0e586d;
      border-radius: 16px;
      padding: 1.5rem 2rem;
      max-width: 700px;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.4);
    }

    h2 {
      font-weight: 700;
      color: #7ce3f0;
      margin-bottom: 1rem;
    }

    fieldset {
      border: 1px solid #0e586d;
      border-radius: 10px;
      margin: 1rem auto;
      max-width: 400px;
      padding: 0.75rem;
      text-align: left;
    }

    label {
      display: block;
      margin: 0.4rem 0;
    }

    input, select {
      border: 1px solid #094a5d;
      background: #04394a;
      color: #e6faff;
      border-radius: 6px;
      padding: 0.4rem 0.6rem;
      font-family: inherit;
      font-size: 1rem;
    }

    button {
      background: linear-gradient(180deg, #16b7c5, #109aa6);
      color: #00252b;
      border: none;
      border-radius: 10px;
      padding: 0.6rem 1rem;
      font-family: 'Ubuntu', sans-serif;
      font-weight: 700;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    button:hover {
      filter: brightness(1.1);
    }

    h3 {
      color: #7ce3f0;
      margin-top: 1.5rem;
    }
  </style>

</style>

</head>
<body>
  <main class="wrap ep-theme">
    <h1>Early Payout Calculator</h1>

    
    <section class="grid g3">
      <div class="panel hi p-blue">
        <div>
          <label for="stake">Back Stake (£)</label>
          <div class="input">
            <span>£</span>
            <input id="stake" type="number" step="1" inputmode="numeric" value="50">
          </div>
        </div>
        <div>
          <label for="backOdds">Back Odds</label>
          <input id="backOdds" type="number" step="0.01" inputmode="decimal" value="2.00">
        </div>
        <div>
          <label for="cashOutBackOdds">Cash Out Back Odds</label>
          <input id="cashOutBackOdds" type="number" step="0.01" inputmode="decimal" value="1.50">
        </div>
      </div>

      <div class="panel hi p-pink">
        <div>
          <label for="layOdds">Lay Odds</label>
          <input id="layOdds" type="number" step="0.01" inputmode="decimal" value="2.10">
        </div>
        <div>
          <label for="layComm">Lay Commission (%)</label>
          <div class="input">
            <input id="layComm" type="number" step="0.1" inputmode="decimal" value="2">
            <span>%</span>
          </div>
        </div>
        <div>
          <label for="backComm">Back Commission (%)</label>
          <div class="input">
            <input id="backComm" type="number" step="0.1" inputmode="decimal" value="2">
            <span>%</span>
          </div>
        </div>
      </div>

      <div class="panel hi p-blue">
        <div>
          <label for="layStakeOut">Lay Stake (auto)</label>
          <div class="copyline">
            <input id="layStakeOut" readonly value="0.00">
            <button id="copyLay" class="btn secondary">Copy</button>
          </div>
          <div class="small">Equal-profit lay for a normal back: (B−1)×S ÷ (L−c)</div>
        </div>
        <div>
          <label for="liabilityOut">Your liability</label>
          <input id="liabilityOut" readonly value="£0.00">
        </div>
      </div>
    </section>

    <div class="bar">Results</div>
    <section class="result-wrap">
      <p class="note" id="headline">
        Place your <b id="stakeTxt">£50.00</b> back bet with your bookmaker at odds of <b id="backOddsTxt">2.00</b>.<br>
        At odds of <b id="layOddsTxt">2.10</b> your lay stake is <b id="layStakeTxt">£0.00</b>.<br>
        Your liability will be <b id="liabilityTxt">£0.00</b>.
      </p>

      <div class="panel switchline">
        <label for="earlyToggle"><b>Has bookmaker paid out early?</b></label>
        <input id="earlyToggle" type="checkbox" />
        <span class="note">Any further results will reflect this input.</span>
      </div>

      <div id="earlyBlock" style="display:none;">
        <div class="panel switchline" style="margin-top:10px;">
          <label for="lockToggle"><b>Early pay out lock-in active?</b></label>
          <input id="lockToggle" type="checkbox" checked />
          <span class="note">If ON, we’ll calculate the cash-out back stake on the exchange.</span>
        </div>

        <div id="lockRow" class="panel hi p-green" style="margin-top:10px;">
          <div>
            <label for="lockBackStake">Back Stake to cash out your lay</label>
            <div class="copyline">
              <input id="lockBackStake" readonly value="£0.00">
              <button id="copyLock" class="btn secondary">Copy</button>
            </div>
          </div>
          <div>
            <label for="lockBackOdds">Use back odds</label>
            <input id="lockBackOdds" type="number" step="0.01" inputmode="decimal" value="1.50">
            <div class="small">Usually the same as “Cash Out Back Odds”.</div>
          </div>
        </div>

        <div class="result-para" id="cashoutLine">
          To cash out your lay bet, place a <b id="lockStakeTxt">£0.00</b> back bet with your exchange at odds of
          <b id="lockOddsTxt">1.50</b>.
        </div>

        <div class="result-para" id="earlyWinLine">
          If your selection goes on to <b>win</b>, from cashing out your lay bet and your bookmaker bet returns
          <b id="bookieReturnWin">£0.00</b> (back stake included), your overall position will be
          <b id="overallIfWin">£0.00</b>.
        </div>
        <div class="result-para" id="earlyLoseLine">
          If your selection <b>fails to win</b>, from cashing out your lay bet and you will gain
          <b id="bookieReturnLose">£0.00</b> (back stake included) from the early pay out, your overall position will be
          <b id="overallIfLose">£0.00</b>.
        </div>
      </div>
    </section>

    <p class="small" style="margin-top:10px">
      Notes: Lay stake formula assumes a standard back (stake returned). Early payout is treated as full settlement
      (stake × back odds). Lock-in uses separate commissions on exchange back/lay winnings.
    </p>
  </main>

  <script>
    // ---------- Helpers ----------
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => [...el.querySelectorAll(s)];
    const toN = v => { const n = parseFloat(v); return Number.isFinite(n) ? n : 0; };
    const money = n => new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP'}).format(Math.round(n*100)/100);

    // ---------- Elements ----------
    const els = {
      stake: $('#stake'), backOdds: $('#backOdds'), cashOutBackOdds: $('#cashOutBackOdds'),
      layOdds: $('#layOdds'), layComm: $('#layComm'), backComm: $('#backComm'),

      layStakeOut: $('#layStakeOut'), liabilityOut: $('#liabilityOut'),
      copyLay: $('#copyLay'),

      earlyToggle: $('#earlyToggle'), earlyBlock: $('#earlyBlock'),
      lockToggle: $('#lockToggle'), lockRow: $('#lockRow'),
      lockBackStake: $('#lockBackStake'), copyLock: $('#copyLock'),
      lockBackOdds: $('#lockBackOdds'),

      // display lines
      stakeTxt: $('#stakeTxt'), backOddsTxt: $('#backOddsTxt'), layOddsTxt: $('#layOddsTxt'),
      layStakeTxt: $('#layStakeTxt'), liabilityTxt: $('#liabilityTxt'),
      cashoutLine: $('#cashoutLine'), lockStakeTxt: $('#lockStakeTxt'), lockOddsTxt: $('#lockOddsTxt'),
      earlyWinLine: $('#earlyWinLine'), earlyLoseLine: $('#earlyLoseLine'),
      bookieReturnWin: $('#bookieReturnWin'), bookieReturnLose: $('#bookieReturnLose'),
      overallIfWin: $('#overallIfWin'), overallIfLose: $('#overallIfLose'),
    };

    // ---------- Events ----------
    $$('.wrap input').forEach(i => i.addEventListener('input', calc));
    els.copyLay.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(parseFloat(els.layStakeOut.value).toFixed(2)); } catch {}
    });
    els.copyLock.addEventListener('click', async () => {
      const txt = els.lockBackStake.value.replace('£','').trim();
      try { await navigator.clipboard.writeText(parseFloat(txt).toFixed(2)); } catch {}
    });
    els.earlyToggle.addEventListener('change', () => {
      els.earlyBlock.style.display = els.earlyToggle.checked ? '' : 'none';
      calc();
    });
    els.lockToggle.addEventListener('change', () => {
      els.lockRow.style.display = els.lockToggle.checked ? '' : 'none';
      calc();
    });

    // ---------- Core calc ----------
    function calc(){
      const S = toN(els.stake.value);
      const B = toN(els.backOdds.value);
      const L = toN(els.layOdds.value);
      const cL = toN(els.layComm.value)/100;
      const cB = toN(els.backComm.value)/100;
      const CO = toN(els.cashOutBackOdds.value);

      // equal profit lay stake for standard back
      let layStake = 0;
      if (L > cL) layStake = ((B - 1) * S) / (L - cL);
      const liability = (L - 1) * layStake;

      // reflect top summary
      els.layStakeOut.value = (Math.round(layStake*100)/100).toFixed(2);
      els.liabilityOut.value = money(liability);
      els.stakeTxt.textContent = money(S);
      els.backOddsTxt.textContent = B.toFixed(2);
      els.layOddsTxt.textContent = L.toFixed(2);
      els.layStakeTxt.textContent = money(layStake);
      els.liabilityTxt.textContent = money(liability);

      // Early payout block
      const early = els.earlyToggle.checked;
      if (!early) return;

      // Bookmaker early payout (full settlement)
      const bookieReturn = S * B; // includes stake
      els.bookieReturnWin.textContent = money(bookieReturn);
      els.bookieReturnLose.textContent = money(bookieReturn);

      // Lock-in calc (cash out the lay using a BACK at lockBackOdds)
      const lockOdds = toN(els.lockBackOdds.value) || CO;
      els.lockOddsTxt.textContent = lockOdds.toFixed(2);

      let SB = 0; // back stake to lock the exchange position
      if (els.lockToggle.checked){
        const denom = lockOdds*(1 - cB) + cB; // = (-CO*cb + CO + cb)
        SB = denom > 0 ? (layStake*(L - cL))/denom : 0;
      }
      els.lockBackStake.value = money(SB);
      els.lockStakeTxt.textContent = money(SB);

      // Exchange P&L after cashing out lay with a BACK (commission on winnings)
      // If selection WINS:
      //   Exchange = -liability  + (lockOdds-1)*SB*(1-cB)
      // If selection LOSES:
      //   Exchange =  layStake*(1-cL)  - SB
      const exIfWin  = -liability + (lockOdds - 1)*SB*(1 - cB);
      const exIfLose =  layStake*(1 - cL) - SB;

      // Overall positions (add bookie early payout and subtract original stake cost)
      const overallWin  = (bookieReturn - S) + exIfWin;
      const overallLose = (bookieReturn - S) + exIfLose;

      els.overallIfWin.textContent  = money(overallWin);
      els.overallIfLose.textContent = money(overallLose);
    }

    // init
    calc();
  </script>
</body>
</html>
